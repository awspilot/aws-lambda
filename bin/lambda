#!/usr/bin/env node

var 
dotenv = require( "dotenv" ),
lambda = require( "../lib/main.js" ),
program = require( "commander" );
//packageJson = require( process.cwd() + "/package.json" );

dotenv.load( );

var
AWS_ENVIRONMENT = process.env.AWS_ENVIRONMENT || "development",
AWS_ACCESS_KEY_ID = process.env.AWS_ACCESS_KEY_ID || "missing",
AWS_SECRET_ACCESS_KEY = process.env.AWS_SECRET_ACCESS_KEY || "missing",
AWS_REGION = process.env.AWS_REGION || "us-east-1",
//AWS_FUNCTION_NAME = process.env.AWS_FUNCTION_NAME || packageJson.name,
AWS_HANDLER = process.env.AWS_HANDLER || "index.handler",
AWS_MODE = "event",
AWS_ROLE = process.env.AWS_ROLE || "missing",
AWS_MEMORY_SIZE = process.env.AWS_MEMORY_SIZE || 128,
AWS_TIMEOUT = process.env.AWS_TIMEOUT || 3,
AWS_DESCRIPTION = process.env.AWS_DESCRIPTION || "",
AWS_RUNTIME = process.env.AWS_RUNTIME || "nodejs";

program
  .usage('deploy <file>')
  .command( "deploy <file>" )
  .description( "Deploy your application to Amazon Lambda" )
  .action( function( prg, options ) {
	//console.log( prg )
	lambda.deploy( prg );
  } );

program
  .version( lambda.version )
  .command( "run" )
  .description( "Run your Amazon Lambda application locally" )
  .option( "-h, --handler [" + AWS_HANDLER + "]", "Lambda Handler {index.handler}", AWS_HANDLER )
  .action( function( prg ) {
    lambda.run( prg );
  } );

program.parse( process.argv );
